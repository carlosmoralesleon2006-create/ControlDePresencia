{% extends "base.html" %}

{% block title %}Gestión de Roles{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <h1 class="mb-5 text-center text-info">
        <i class="fas fa-user-tag me-2"></i> Gestión de Roles de Empleados
    </h1>
    <p class="text-center text-muted mb-4">
        Define los roles dentro de tu organización (Ej: Empleado, Administrador, Superadministrador).
    </p>

    <div class="row justify-content-center">
        
        <div class="col-lg-5 mb-4">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0" id="rol-form-title">Alta de Nuevo Rol</h5>
                </div>
                <div class="card-body">
                    <form id="formRol" method="POST" action="{{ url_for('main.rol_nuevo') }}">
                        <input type="hidden" name="rol_id" id="rol_id" value="">
                        
                        <div class="mb-3">
                            <label for="nombre_rol" class="form-label">Nombre del Rol (*)</label>
                            <input type="text" 
                                   class="form-control rounded-pill" 
                                   id="nombre_rol" 
                                   name="nombre" 
                                   required 
                                   placeholder="Ej: Administrador">
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-info text-white">
                                <i class="fas fa-plus me-2"></i> Crear Rol
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="resetRolForm()">
                                <i class="fas fa-undo me-1"></i> Limpiar Formulario
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-7 mb-4">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">Roles Registrados ({{ roles | length }})</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        {% for rol in roles %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                
                                <span class="fw-bold">{{ rol.nombre }} 
                                    {% if rol.empleados | length > 0 %}
                                        <span class="badge bg-secondary ms-2" title="Empleados con este rol">{{ rol.empleados | length }}</span>
                                    {% endif %}
                                </span>
                                
                                <div class="btn-group" role="group">
                                    {% set rol_data = {'id': rol.id, 'nombre': rol.nombre} %}
                                    <button type="button" 
                                            class="btn btn-sm btn-outline-info" 
                                            title="Modificar Nombre"
                                            onclick='editarRol({{ rol_data | tojson }})'>
                                        <i class="fas fa-edit"></i>
                                    </button>

                                    <form method="POST" action="{{ url_for('main.rol_eliminar', rol_id=rol.id) }}" class="d-inline" 
                                          onsubmit="return confirm('¿Eliminar el rol {{ rol.nombre }}?');">
                                        <button type="submit" 
                                                class="btn btn-sm btn-outline-danger" 
                                                title="Eliminar Rol"
                                                {% if rol.empleados | length > 0 %} disabled {% endif %}>
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </li>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function editarRol(rol) {
        document.getElementById('rol_id').value = rol.id;
        document.getElementById('nombre_rol').value = rol.nombre;

        document.getElementById('rol-form-title').textContent = 'Modificación de Rol (ID: ' + rol.id + ')';
        document.querySelector('#formRol button[type="submit"]').textContent = 'Guardar Cambios';
        
        document.getElementById('formRol').action = '{{ url_for("main.rol_nuevo") }}'; 
    }

    function resetRolForm() {
        document.getElementById('rol_id').value = '';
        document.getElementById('nombre_rol').value = '';

        document.getElementById('rol-form-title').textContent = 'Alta de Nuevo Rol';
        document.querySelector('#formRol button[type="submit"]').textContent = 'Crear Rol';
        
        document.getElementById('formRol').action = '{{ url_for("main.rol_nuevo") }}';
    }
</script>
</script>
{% endblock %}